---
layout: post
title: "JNI 사용해보기"
date: 2020-03-30 00:00:01
author: Keelim
categories: AOSP
comments: true
toc: true
toc_sticky: true
---

## JNI 사용기

자바 프레임워크를 보면서 JNI 를 개념을 이해하기 위하여
직접 코드를 작성하고 , dll을 빌드를 하여 JNI 를 실행을 해보기로 하였다.

### Jva 코드 작성

JNI 를 사용을 하기 위하여 먼저 자바 java 코드를 먼저 작성을 하였다.

```java
public class JNI {
    static {
        System.loadLibrary("JNI");
    }

    private native int getNumber();

    private native void printHelloWorld();

    public static void main(String[] args) {
        JNI jni = new JNI();

        jni.printHelloWorld();
        System.out.println(jni.getNumber());
    }
}

```

### JNI 헤더 파일

JNK 8 이전에는 javah 를 통해서 JNI.h 를 만들었지만 jdk 이후 javac -h 를 통해서 헤더파일을 만들 수 있다.

```cpp
/* DO NOT EDIT THIS FILE - it is machine generated */
#include <jni.h>
/* Header for class JNI */

#ifndef _Included_JNI
#define _Included_JNI
#ifdef __cplusplus
extern "C" {
#endif
/*
 * Class:     JNI
 * Method:    getNumber
 * Signature: ()I
 */
JNIEXPORT jint JNICALL Java_JNI_getNumber
  (JNIEnv *, jobject);

/*
 * Class:     JNI
 * Method:    printHelloWorld
 * Signature: ()V
 */
JNIEXPORT void JNICALL Java_JNI_printHelloWorld
  (JNIEnv *, jobject);

#ifdef __cplusplus
}
#endif
#endif

```

javah 를 이용하여 만든 헤더 파일

### C코드 작성 및 빌드-> .dll 파일을 생성

```cpp
#include <stdio.h>
#include <jni.h>
#include "JNI.h"

JNIEXPORT jint JNICALL Java_JNI_getNumber (JNIEnv *, jobject){
      return 3;
  }

JNIEXPORT void JNICALL Java_JNI_printHelloWorld (JNIEnv *, jobject){
    printf("Helloworld");
}
```

코드를 작성을 하고 64비트로 빌드 환경을 구성을 하여 빌드
.dll 파일을 만든다.

### java 실행 모습

콘솔에서 자바가 실행되는 모습을 볼 수 있다
![결과](/docs/assests/jnianswer.png)