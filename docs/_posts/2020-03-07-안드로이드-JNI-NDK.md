---
layout: post
title: "ì•ˆë“œë¡œì´ë“œ í”„ë ˆì„ì›Œí¬  JNI NDK 1"
date: 2020-03-07 00:00:01
author: Keelim
categories: AOSP
comments: true
toc: true
toc_sticky: true
tags:
    - android 
    - aosp
    - go
---

4.1 ì•ˆë“œë¡œì´ë“œì™€ JNI

- 4.1.1 ì™œ ì•ˆë“œë¡œì´ë“œì—ì„œ JNIë¥¼ ì•Œì•„ì•¼ í•˜ëŠ”ê°€?

## ì•ˆë“œë¡œì´ë“œì™€ JNI

- ì•ˆë“œë¡œì´ë“œ í”„ë ˆì„ì›Œí¬ = C/C++ ê¸°ë°˜ ëª¨ë“ˆ + ìë°”(Java) ê¸°ë°˜ ëª¨ë“ˆ  (kotlin?)

- ex> GPS ê´€í˜„ ì–´í”Œë¦¬ì¼€ì´ì…˜

    ì•ˆë“œë¡œì´ë“œ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ GPS ì •ë³´ë¥¼ ì–»ê¸° ìœ„í•´ ì• í”Œë¦¬ì¼€ì´ì…˜ í”„ë ˆì„ì›Œí¬ì˜ Location Managerê°€ ì œê³µ  ìë°” APIë¥¼ í˜¸ì¶œ (ì–´í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ Location Managerë¥¼ í˜¸ì¶œí•˜ë„ë¡ í”„ë¡œê·¸ë˜ë° ê°€ëŠ¥)
    í”„ë ˆì„ì›Œí¬ ë‚´ë¶€ì˜ GPS ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ í†µí•´ GPS ë””ë°”ì´ìŠ¤ ë“œë¼ì´ë¸Œì— ì—°ê²° ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ í˜„ì¬ ìœ„ì¹˜ ì •ë³´ ê°’ì„ ì „ë‹¬í•´ì£¼ëŠ” êµ¬ì¡°ë¡œ ë™ì‘ -> C/C++ ë ˆì´ì–´ì™€ ìë°” ë ˆì´ì–´ê°€ ì„œë¡œ ìƒí˜¸ ì‘ìš©í•˜ë©° ë™ì‘.
    ìë°” ë ˆì´ì–´(ìƒìœ„)ì™€ C/C++ ë ˆì´ì–´(í•˜ìœ„)ë¥¼ ìƒí˜¸ ì—°ê²°í•´ ì£¼ëŠ” ë§¤ê°œì²´ == JNI(Java Native Interface)

---

## JNI(Java Native Interface)

- JNI : ë„¤ì´í‹°ë¸Œ ì–¸ì–´(ìë°” ì´ì™¸ì˜ ì–¸ì–´)ë¡œ ë§Œë“¤ì–´ì§„ ëª¨ë“ˆì´ë‚˜ ì• í”Œë¦¬ì¼€ì´ì…˜ê³¼ ìë°” í´ë˜ìŠ¤ê°€ ì„œë¡œ ìƒí˜¸ì‘ìš©í•  ìˆ˜ ìˆê²Œ ì •ì˜í•œ ì¸í„°í˜ì´ìŠ¤.

  - ex>, ìë°” í´ë˜ìŠ¤ì—ì„œ C ì–¸ì–´ë¡œ ì‘ì„±ëœ ë¼ì´ë¸ŒëŸ¬ë¦¬ì— í¬í•¨ëœ íŠ¹ì • í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ê±°ë‚˜ ë°˜ëŒ€ë¡œ C í”„ë¡œê·¸ë¨ì—ì„œ ìë°” í´ë˜ìŠ¤ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ê³  ì‹¶ì„ ë•Œ JNIë¥¼ ì‚¬ìš©í•œë‹¤.  

### JNIë¥¼ í™œìš©í•˜ëŠ” ê²½ìš°  

1. ë¹ ë¥¸ ì²˜ë¦¬ ì†ë„ë¥¼ ìš”êµ¬í•˜ëŠ” ë£¨í‹´ì„ ì‘ì„±  
    - ìë°”ê°€ ë„¤ì´í‹°ë¸Œ ì–¸ì–´ë³´ë‹¤ ëŠë¦¼.
2. í•˜ë“œì›¨ì–´ ì œì–´  
    - í•˜ë“œì›¨ì–´ ì œì–´ ì½”ë“œë¥¼ Cë¡œ ì‘ì„±í•˜ë©´ ìë°”ì—ì„œë„ í•˜ë“œì›¨ì–´ ì œì–´ ê°€ëŠ¥.
3. ê¸°ì¡´ C/C++ í”„ë¡œê·¸ë¨ì˜ ì¬ì‚¬ìš©  

### JNIì˜ í•„ìš”ì„±  

1. ì•ˆë“œë¡œì´ë“œ ì• í”Œë¦¬ì¼€ì´ì…˜ ê°œë°œì ì…ì¥  
ì•ˆë“œë¡œì´ë“œ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ê°€ìƒ ë¨¸ì‹  ìœ„ì—ì„œ ë™ì‘í•˜ëŠ” ìë°” ê¸°ë°˜ í”„ë¡œê·¸ë¨ì´ë‹¤. ë”°ë¼ì„œ ëŠë¦° ì‹¤í–‰ ì†ë„ë¥¼ ì§€ë‹Œë‹¤. ê·¸ë˜í”½ ì²˜ë¦¬ë‚˜ ì‹œê·¸ë„ í”„ë¡œì„¸ì‹± ê°™ì€ ê²½ìš° C/C++ ê°™ì€ ë„¤ì´í‹°ë¸Œ ì½”ë“œë¡œ ì‘ì„±í•œ ëª¨ë“ˆì´ í›¨ì”¬ ë” ë‚˜ì€ ì„±ëŠ¥ì„ ë‚¼ ê²ƒì´ë‹¤.  

í”„ë¡œê·¸ë¨ ì£¼ìš” ëª¨ë“ˆì€ ìë°” ê°œë°œìê°€, ì„±ëŠ¥ì— ë¯¼ê°í•œ ëª¨ë“ˆì€ C/C++ ê°œë°œìê°€ ì‘ì„±í•˜ì—¬ JNIë¥¼ í†µí•´ ì—°ê²°í•˜ë©´ ì„±ëŠ¥ì´ ë›°ì–´ë‚œ í”„ë¡œê·¸ë¨ ê°œë°œì´ ê°€ëŠ¥í•˜ë‹¤.  

ì‹¤ì œë¡œ ì•ˆë“œë¡œì´ë“œ ì• í”Œë¦¬ì¼€ì´ì…˜ ê°œë°œìëŠ” ì•ˆë“œë¡œì´ë“œ SDK(Software Development Kit)ë¥¼ ì´ìš©í•´ ìë°” ê¸°ë°˜ì˜ í”„ë¡œê·¸ë¨ì„ ì‘ì„±.

ì•ˆë“œë¡œì´ë“œì—ì„œ ì œê³µí•˜ëŠ” NDK(Native Development Kit)ë¥¼ ì´ìš©í•´ì„œ ìë°” ì• í”Œë¦¬ì¼€ì´ì…˜ê³¼ ì—°ê²° ê°€ëŠ¥í•œ C/C++ ê¸°ë°˜ì˜ ë„¤ì´í‹°ë¸Œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‘ì„±í•˜ì—¬ JNIë¥¼ ì‚¬ìš©. (íŠ¹íˆ ì»´í“¨í„° ë¹„ì „, open CV ê°™ì€ ê¸°ìˆ ì„ ì‚¬ìš©ì„ í•  ê²½ìš°)

#### (í”„ë¡œì íŠ¸ì—ì„œëŠ” PDKë¥¼ ì•Œì•„ë³¼ í•„ìš”ê°€ ìˆìŒ PDK (Platform development Kit)-> ì œì¡°ì‚¬ë¥¼ ì´ë¥¼ ì´ìš©í•˜ì—¬ í•˜ë“œì›¨ì–´ì˜ ì•ˆë“œë¡œì´ë“œë¥¼ ìˆ˜ì •í•˜ì—¬ í¬íŒ… -> ì •í™•í•œ ìë£Œ í•„ìš”)

1. ì•ˆë“œë¡œì´ë“œ í”Œë«í¼ ê°œë°œì ì…ì¥  
ì•ˆë“œë¡œì´ë“œë¥¼ íƒ‘ì¬í•  ì¥ì¹˜ì— ì•ˆë“œë¡œì´ë“œ í”„ë ˆì„ì›Œí¬ì—ì„œ ì§€ì›í•˜ì§€ ì•ŠëŠ” í•˜ë“œì›¨ì–´ê°€ ì„¤ì¹˜ë¼ ìˆëŠ” ê²½ìš°
ì´ ê²½ìš° ì§€ì›í•˜ì§€ ì•ŠëŠ” ì¥ì¹˜ë¥¼ ì œì–´í•˜ê¸° ìœ„í•´ ë””ë°”ì´ìŠ¤ ë“œë¼ì´ë²„ë¥¼ C ì–¸ì–´ë¡œ êµ¬í˜„.
PT: í•˜ë“œì›¨ì–´(C/C++) // ì‚¬ìš©ì ì…ì¥{ì–´í”Œë¦¬ì¼€ì´ì…˜}(JAVA) -> í˜„ì¬ JAVA ì½”í‹€ë¦°ìœ¼ë¡œ ë³€ê²½ ì¤‘

C ì–¸ì–´ë¡œ ë“œë¼ì´ë²„ë¥¼ êµ¬í˜„í•´ë„ ìë°”ë¥¼ ì‚¬ìš©í•˜ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ ê°œë°œìê°€ í•˜ë“œì›¨ì–´ë¥¼ ì´ìš©í•˜ê¸° ìœ„í•´ì„œ C ì–¸ì–´ë¡œ êµ¬í˜„ëœ ë“œë¼ì´ë²„ë¥¼ ì§ì ‘ ì‚¬ìš©í•  ìˆ˜ ì—†ìŒ.  

ë”°ë¼ì„œ í”Œë«í¼ ê°œë°œìëŠ” í•˜ë“œì›¨ì–´ ì œì–´ìš© ìë°” APIë¥¼ ì œê³µí•´ì•¼ í•œë‹¤. ì´ë¥¼ ìœ„í•´ C/C++ë¡œ êµ¬í˜„ëœ í•˜ë“œì›¨ì–´ ë””ë°”ì´ìŠ¤ ë“œë¼ì´ë²„ë¥¼ JNIë¥¼ ì´ìš©í•´ ìë°” APIë¡œ ë§¤í•‘.
ì´ë ‡ê²Œ í•´ì•¼ ì•ˆë“œë¡œì´ë“œ ì• í”Œë¦¬ì¼€ì´ì…˜ ê°œë°œìëŠ” ìë°”ë¡œ ì‘ì„±ëœ APIë¥¼ í†µí•´ ìƒˆë¡œ ì¶”ê°€ëœ í•˜ë“œì›¨ì–´ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.  

PT: ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•˜ì—¬ ì•ˆë“œë¡œì´ë“œ Treble í”„ë¡œì íŠ¸ ì´ë£¨ì–´ì§„ ê²ƒì´ë¼ê³  ìƒê°.
`Treble`: í•˜ë“œì›¨ì–´ ì¢…ì†ì„±ì„ ìµœëŒ€í•œ ë°°ì œí•˜ì—¬ ë¹ ë¥´ê²Œ ì•ˆë“œë¡œì´ë“œê°€ ê°ê°ì˜ í•˜ë“œì›¨ì–´ì˜ ì„ë² ë”© í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ê¸°ìˆ 
(ì •í™•í•œ ìë£Œ í•„ìš”)

---

## JNIì˜ ê¸°ë³¸ ì›ë¦¬ ì´í•´

### ìë°”ì—ì„œ C ë¼ì´ë¸ŒëŸ¬ë¦¬ í•¨ìˆ˜ í˜¸ì¶œí•˜ê¸°

ìë°” ì¸¡ì—ì„œ JNI ì½”ë“œë¥¼ ì‚¬ìš©í•˜ì—¬ Cí•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ê¸° ìœ„í•˜ì—¬

- 1. ìë°” ì½”ë“œ ì‘ì„±
- 2. ìë°” ì½”ë“œ ì»´íŒŒì¼
- 3. C í—¤ë” íŒŒì¼ ìƒì„±
- 4. C ì½”ë“œ ìƒì„±
- 5. C ê³µìœ  ë¼ì´ë¸ŒëŸ¬ë¦¬ ìƒì„±
- 6. ìë°” í”„ë¡œê·¸ë¨ ì‹¤í–‰

#### ìë°” ì½”ë“œ ì‘ì„±

ìë°” í´ë˜ìŠ¤ì— ë„¤ì´í‹°ë¸Œ ë©”ì„œë“œ ì„ ì–¸

```java
class HelloJNI{
    native void printHello(); //native ì™¸ë¶€ ë‹¤ë¥¸ ì–¸ì–´ë¡œ ì‘ì„±ëœ ì½”ë“œ ì‚¬ìš© í‚¤ì›Œë“œ
    native void printString(String str);

    static {System.loadLibrary("hellojni");} // ë¼ì´ë¸ŒëŸ¬ë¦¬ í˜¸ì¶œ

    public static void main(String[] args) {
        HelloJNI jni = new HelloJNI();

        jni.printHello();
        jni.printString("Hello world from printString fun");
    }
}
```

#### ìë°” ì½”ë“œ ì»´íŒŒì¼

ì´ ìƒíƒœë¡œ ì»´íŒŒì¼ì‹œ jni ì—ì„œ ì‚¬ìš©í•˜ëŠ” dll íŒŒì¼ì´ ë§Œë“¤ì–´ ì§€ì§€ ì•Šê³ , HelloJNI.class íŒŒì¼ë§Œ ìƒì„±
ì´ë¥¼ ìœ„í•´ .dll íŒŒì¼ ë§Œë“¤ê¸° í•„ìš”

#### C í—¤ë” íŒŒì¼ ìƒì„±

ìë°” ê°€ìƒë¨¸ì‹ ì€ ì˜¬ë°”ë¥¼ê²Œ DLL ì„ í˜¸ì¶œì„ í•  ìˆ˜ ìˆì„ ê²ƒì¸ê°€?

```c++
//dll íŒŒì¼
void printHello(){
    printf("Hello world\n");
    return;
}

void printString(String str){
    printf("%s!\n", str);
    return;
}
```

ì´ëŸ¬í•œ ìƒí™©ì—ì„œ ìë°” ê°€ìƒë¨¸ì‹ ì´ ë„¤ì´í‹°ë¸Œ ë©”ì„œë“œë¥¼ ì°¾ì§€ ëª»í•˜ì˜€ì„ ë•Œ
`Exception in thread "main" java.lang.UnsatisfiedLinkError: HelloJNI.printHello()`
ì˜¤ë¥˜ ë°œìƒ

vm(ê°€ìƒ ë¨¸ì‹ )ì€ ë„¤ì´í‹°ë¸Œ ë¼(ì´ë¸ŒëŸ¬ë¦¬ì—ì„œ í•¨ìˆ˜ë¥¼ ì°¾ì•„ ë§¤í•‘ í…Œì´ë¸”ì„ ë§Œë“¤ì–´ ë†“ê³  ìë°” ë„¤ì´í‹°ë¸Œ ë©”ì„œë“œì™€
Cí•¨ìˆ˜ë¥¼ ë§í¬(ì—°ê²°) í•¨.

-> ê°€ìƒ ë¨¸ì‹ ì€ ì–´ë–»ê²Œ C í•¨ìˆ˜ ì¤‘ì— ë„¤ì´í‹°ë¸Œ ë©”ì„œë“œì™€ ë§í¬ê°€ ë˜ëŠ” í•¨ìˆ˜ë¥¼ ì°¾ëŠ”ê°€?

í•¨ìˆ˜ì˜ ì›í˜•ì„ ì‘ì„±ì„ í•˜ì—¬ í•¨ìˆ˜ì˜ í˜•íƒœë¡œ ê°€ìƒë¨¸ì‹ ì€ ì‹ë³„ì„ í•¨.

`javah` -> JNI êµ¬í˜„ìš© í—¤ë” íŒŒì¼ êµ¬ì„± ê°€ëŠ¥

```c++
JNIEXPORT void JNICALL Java_HelloJNI_printHello(JNIENV *, jobject)
JNIEXPORT void JNICALL Java_HelloJNI_printString(JNIENV *, jobject, jstring)
        ë°˜í™˜íƒ€ì…       ì ‘ë‘ì‚¬ í´ë˜ìŠ¤ ë„¤ì´í‹°ë¸Œë©”ì„œë“œ ê³µí†µë§¤ê°œë³€ìˆ˜

```

JNIEnv * í¬ì¸í„°, JNI í•¨ìˆ˜ í˜¸ì¶œ
jobject ìë°” ë„¤ì´í‹°ë¸Œ íƒ€ì… C ì½”ë“œì—ì„œ ìë°” ê°ì²´ ì ‘ê·¼ í•  ë•Œ ì‚¬ìš©. (Jë¥¼ ë¶™ì¸ ê²ƒìœ¼ë¡œ ìƒê°ì„ í•  ìˆ˜ ìˆë‹¤.)
jstring `String str` ë§¤ê°œ ë³€ìˆ˜ë¡œ ì¸í•˜ì—¬ `jstring` ì´ ì¶”ê°€ë¨.

#### C/C++ ì½”ë“œ êµ¬í˜„

```c++
#include "HelloJNI.h"
#include <stdio.h>

JNIEXPORT void JNICALL Java_HelloJNI_printHello(JNIENV *, jobject){
    printf("Hello world\n");
    return;
}
JNIEXPORT void JNICALL Java_HelloJNI_printString(JNIENV *, jobject obj, jstring string){
    const char *str = (*env)->GetStringUTFChars(env, string, 0)
    printf("%s!\n", str);
    return;
}
```

#### C ê³µìœ  ë¼ì´ë¸ŒëŸ¬ë¦¬ ìƒì„±

#### ìë°” í”„ë¡œê·¸ë¨ ì‹¤í–‰

![ì˜ˆì œ ê²°ê³¼](/docs/assets/jni-ndk-example.png)  

---

### ì •ë¦¬

JNI ë¥¼ í†µí•´ ìë°”ì™€ C ì—°ê²°ì´ ë˜ëŠ” ìˆœì„œëŠ”

- ìë°” í´ë˜ìŠ¤ì—ì„œ ë„¤ì´í‹°ë¸Œ ë©”ì„œë“œ ì„ ì–¸
- javah ì´ìš© JNI ë„¤ì´í‹°ë¸Œ í•¨ìˆ˜ í¬í•¨ëœ í—¤ë” íŒŒì¼ ìƒì„±
- JNI ë„¤ì´í‹°ë¸Œ í•¨ìˆ˜ êµ¬í˜„
- C ê³µìœ  ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¹Œë“œ
- JNIë¥¼ í†µí•œ JNI ë„¤ì´í‹°ë¸Œ í•¨ìˆ˜ í˜¸ì¶œ

---

### JNI í•¨ìˆ˜ ì´ìš©í•˜ê¸°

JNI í•¨ìˆ˜ì—ì„œ ìë°” ì½”ë“œë¥¼ ì œì–´í•˜ëŠ” ë°©ë²•

- ìë°” ê°ì²´ ìƒì„±
- í´ë˜ìŠ¤ì˜ ì •ì  ë©¤ë²„ í•„ë“œì— ì ‘ê·¼í•˜ê¸°
- í´ë˜ìŠ¤ì˜ ì •ì  ë©”ì„œë“œ í˜¸ì¶œí•˜ê¸°
- ìë°” ê°ì²´ì˜ ë©¤ë²„ í•„ë“œì— ì ‘ê·¼í•˜ê¸°
- ìë°” ê°ì²´ì˜ ë©”ì„œë“œ ì ‘ê·¼í•˜ê¸°

### JNI í•¨ìˆ˜ë¥¼ í™œìš©í•˜ëŠ” ì˜ˆì œ í”„ë¡œê·¸ë¨ì˜ êµ¬ì¡°

(ë‚´ìš© ë³´ì¶©)

### ìë°”ì¸¡ ì½”ë“œ ì‚´í´ë³´ê¸°

jniFuncMain.java ì½”ë“œ ì‚´í´ë³´ê¸°

```java
public class JniFuncMain{
    private static int staticIntField = 300;

    static {System.loadLibrary("jnifunc");}

    public static natice JniTest createJniObject() //ë„¤ì´í‹°ë¸Œ ë©”ì„œë“œ ì„ ì–¸

    public static void main(String[] args) {
        System.out.println("[Java] createJniObject() ë„¤ì´í‹°ë¸Œ ë©”ì„œë“œ í˜¸ì¶œ");

        JniTest jniObj = createJniObject();

        jniObj.callTest();

    }
}
```

```java
class JniTest{
    private int intField;

    public JniTest(int num){
        intField = num;
        System.out.println("[java] JniTest ê°ì²´ì˜ ìƒì„±ì í˜¸ì¶œ: intField =" + intField);
    }

    public int callByNative(int num){
        System.out.println("[Java] JniTest ê°ì²´ì˜ callByNatice("+num+") í˜¸ì¶œ");
        return num;
    }

    public void callTest(){
        System.out.println("[Java] Jnitest ê°ì²´ì˜ callTest() ë©”ì„œë“œ í˜¸ì¶œ: intField = " + intField);
    }
}
```

#### 4.3.3 JNI ë„¤ì´í‹°ë¸Œ í•¨ìˆ˜ì˜ ì½”ë“œ ì‚´í´ë³´ê¸°

javahë¥¼ í†µí•˜ì—¬ í•¨ìˆ˜ ì›í˜•ì„ ìƒì„±ìœ¼ë¡œ í—¤ë”íŒŒì¼ì„ ë§Œë“ ë‹¤.

(ë³´ì¶©)
jnifunc.cpp

```cpp

JNIEXPORT jobject JNICALL Java_JniFuncMain_createJniObject(JNIEnv *env, jclass class){
    jclass targetClass;
    jmethodID mid;
    jobject newObject;
    jstring helloStr;
    jfield fid;
    jint staticIntField;
    jint result;

    //staticIntField í•„ë“œ ê°’ ì–»ì–´ì˜¤ê¸°
    fid = env-> GetStaticField(class, "staticIntField", "I");
    staticIntField =env->GetStaticField(clazz, fid);
    printf("[CPP] JniFuncMain í´ë˜ìŠ¤ì˜ staticIntField í•„ë“œ ê°’ ì–»ì–´ì˜¤ê¸° \n");

    targetClass = env->FindClass("JniTest");

    mid=env-> GetMethodID(targetClass, "<init>", "(I)V");

    printf("[CPP] JniTest")

}

```

- 4.3.4 ì»´íŒŒì¼ ë° ì‹¤í–‰ ê²°ê³¼
- 4.3.5 ì•ˆë“œë¡œì´ë“œì—ì„œì˜ í™œìš© ì˜ˆ
4.4 C í”„ë¡œê·¸ë¨ì—ì„œ ìë°” í´ë˜ìŠ¤ ì‹¤í–‰í•˜ê¸°
- 4.4.1 í˜¸ì¶œ API ì‚¬ìš© ì˜ˆì œ
- 4.4.2 ì»´íŒŒì¼ ë° ì‹¤í–‰
- 4.4.3 ì•ˆë“œë¡œì´ë“œì—ì„œ í™œìš© ì˜ˆ : Zygote í”„ë¡œì„¸ìŠ¤
4.5 JNI ë„¤ì´í‹°ë¸Œ í•¨ìˆ˜ ì§ì ‘ ë“±ë¡í•˜ê¸°
- 4.5.1 ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ ì‹œì— JNI ë„¤ì´í‹°ë¸Œ í•¨ìˆ˜ ë“±ë¡í•˜ê¸°
- 4.5.2 ì•ˆë“œë¡œì´ë“œì—ì„œì˜ í™œìš© ì˜ˆ : app_process í”„ë¡œì„¸ìŠ¤

```cpp
#include "jni.h
#include <stdio.h>

void printHelloNative(JNIEnv *env, jobject obj);
void printStringNative(JNIEnv *env, jobject obj, jstring string);

JNIEXPORT jint JNICALL JNI_OnLoad(JavaVM *vm, void *reserved){
    JNIEnv *env = NULL;
    JNINativeMethod nm[2];
    jclass cls;
    jint result = -1;

    if(vm-> GetEnv(void**) &env, JNI_VERSION_1_4)!=JNI_OK){
        printf("Error");
        return JNI_ERR;
    }

    clas = env -> FindClass("HelloJNI");

    nm[0].name = "printHello";
    nm[0].sinfnature="()V";
    nm[0].fnPtr = (void*) printStringNative;

    env -> RegisterNatives(cls, nm, 2);
    return JNI_VERSION_1_4;
}

void printHelloNative(JNIEnv *env, jobject obj){
    printf("Hello World\n");
    return ;
}

void printStringNative(JNIEnv *env, jobject obj, jstring string){
    const char *str = env->GetStringUTFChars(string, 0);
    printf("%s\n", str);
    return ;
}

```

JNI_Onload()

```cpp
extern "C" jint JNI_OnLoad(JavaVM* vm, void* reserved){
    JNIEnv *env = NULL;
    jint result = -1;

    if(vm-> GetEnv(void**) &env, JNI_VERSION_1_4)!=JNI_OK){
        LOGE("GetEnv failed\n");
        return;
    }

    register_android_server_KeyInputQueue(env);
    register_android_server_HardwareService(env);
    register_android_server_AlarmmangerService(env);
    register_android_server_BatterService(env);
    register_android_server_SensorService(env);
    register_android_server_SystemServer(env);

    return JNI_VERSION_1_4;
}


static JNINativeMethod getMethod[] = {
    {"init1", "[LJava/lang/String]V", (void*) android_server_SystemServer_int1,
};

int register_android_serer_SystemServer(JNIEnv *env){
    return jniRegisterNativeMethods(env, "com/android/server/SystemServer", gmethod,NELE(gMethods));

}

static void android_server_SystemServer_int1(JNIEnv *env, jobject clazz){
    system_init();
}


```

## references

- <https://source.android.com>
- <https://developer.android.com>
- ì¸ì‚¬ì´ë“œ ì•ˆë“œë¡œì´ë“œ
- Android Internals Vol 1
- Embedded Android

#### ğŸ§¶ ëª¨ë“  ë¬¸ì„œëŠ” ìˆ˜ì •ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
