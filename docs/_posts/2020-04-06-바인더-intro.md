---
layout: post
title: "바인더(0)"
date: 2020-04-06 00:00:01
author: Keelim
categories: AOSP
comments: true
toc: true
toc_sticky: true
---

Linux 프로세스, Android는 프로세스 단위의 컴포넌트 모델을 제공한다. 카메라 기능을 제공하는 시스템 서비스, 화면 출력을 담당하는 시스템 서비스 등 Android 컴포넌트는 결국 Linux의 프로세스의 표현.

Linux의 메모리, 프로세스, 파일 관리를 기반 동작 -> 시스템 서비스 또한 Linux 프로세스로 격리(isolation)되어 보호 동작. 시스템 프로세스는 C++ 네이티브 코드뿐만 아니라 Java 코드로 작성되어 Dalvik VM에서 동작하는 서비스(Wi-Fi, Location, Activity Service 등)

Android에서 모바일 환경을 위하여 기본으로 제공하는 시스템 기능은 모두 서버 프로세스 형태로 제공. 즉, 화면을 그리거나(Surface Flinger) 소리를 내고 조절(Audio Flinger)하는 기능 등을 사용하려면 사용자 모드(User Mode)에서 동작하는 별도의 프로세스에 화면을 그리고 소리를 내라고 요청
*flinger: Surface, Audio 던지는 주체

```모든 시스템 서비스가 서버 프로세스 형태로 제공되기 때문에``` 다른 프로세스로 요청과 응답을 보내는 메커니즘이 필요한데, 이 메커니즘이 바인더(Binder). Android에서는 다른 프로세스가 제공하는 기능을 바인더를 통해 사용.

![안드로이드의 프로세스간 통신 인프라 바인더(Binder)](https://d2.naver.com/content/images/2015/06/helloworld-47656-5.png)

IPC(inter process comunication) socket, pipe -> 성능. 프로세스 통신의 적합한 바인더 프로토콜. 바인더는 모든 프로세스가 공유하는 커널 메모리를 참조 함으로써 메모리 복사 오버헤드를 줄인다. 뿐만 아니라 C++을 이용해 작성된 RPC(Remote Procedure Call) 프레임워크를 제공하여 생산성이 높다.

시스템에서 제공하는 기능을 서버 프로세스 형태로 제공하고 바인더 메커니즘을 통해 요청과 응답을 받는 구조

### 장점

- 새로운 시스템 서비스를 추가하거나 기존의 기능을 제거 쉬움
- 새로운 프로세서로 포팅 시 변경 부위가 작다. 포팅을 위한 툴체인도 제공. 포팅이 쉬움
- 손쉬운 테스트: 테스트가 컴포넌트 단위로 한정되어 전체를 테스트하는 번거로움이 줄고 엄격하게 테스트
- 분산 시스템 지원: 바인더 기반의 프로세스 통신을 하기 때문에 컴포넌트 간 위치 투명성이 보장.

모든 기능을 엮는 바인더 ```"모든 프로세스가 공유할 수 있는 영역에 요청 내용과 응답 내용을 쓰고, 각 프로세스가 그 메모리 주소를 참조".``` 이를 위해 커널 공간이 사용.

커널 공간을 사용하도록 바인더 드라이버가 구현되어 있다. 바인더 드라이버의 역할은 각 프로세스가 매핑해 놓은 메모리 주소와 커널 공간의 메모리 주소를 변환하여 참조해 사용

![바인더 드라이버 구성](https://d2.naver.com/content/images/2015/06/helloworld-47656-7.png)

Linux에서 사용하는 표준 방법인 ioctl 시스템 함수를 이용해 바인더 드라이버를 사용. 바인더 IPC
(*ioctl?)

![바인더 드라이버를 통한 프로세스 간 사용자 데이터 송수신 구조](https://d2.naver.com/content/images/2015/06/helloworld-47656-8.png)

바인더 IPC를 이용해 주고받는 데이터를 가공해서 RPC(Remote Procedure Call)로 만들어 주는 C++ 프레임워크가 제공되고 시스템 서비스를 만들 때 사용. 다른 프로세스에서 제공하는 함수를 마치 내 함수처럼 사용 있게 하는 것.
